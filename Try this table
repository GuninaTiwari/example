import pdfplumber
import pandas as pd
import re

pdf_file = "input.pdf"
excel_file = "output.xlsx"

writer = pd.ExcelWriter(excel_file, engine="openpyxl")

with pdfplumber.open(pdf_file) as pdf:
    current_table_name = None
    table_data = []
    
    for page_num, page in enumerate(pdf.pages, start=1):
        text = page.extract_text()
        print(f"\n--- Page {page_num} ---")
        print(text[:300])  # sirf pehle 300 characters print karo dekhne ke liye
        
        lines = text.split("\n") if text else []
        
        for i, line in enumerate(lines):
            match = re.match(r"Table\s*:\s*(.+)", line)
            if match:
                if current_table_name and table_data:
                    df = pd.DataFrame(table_data[1:], columns=table_data[0])
                    df.to_excel(writer, sheet_name=current_table_name[:31], index=False)
                    table_data = []
                current_table_name = match.group(1).strip()
                print(f"ğŸ”¹ Found table name: {current_table_name}")
            
            if "Columns" in line:
                tables = page.extract_tables()
                print(f"ğŸ”¹ Found 'Columns' in line: {line}")
                if tables:
                    print(f"âœ… Table extracted with {len(tables[0])} rows")
                    table_data = tables[0]
                else:
                    print("âŒ No table found on this page")

    if current_table_name and table_data:
        df = pd.DataFrame(table_data[1:], columns=table_data[0])
        df.to_excel(writer, sheet_name=current_table_name[:31], index=False)

writer.close()
print(f"\nExcel file saved: {excel_file}")
