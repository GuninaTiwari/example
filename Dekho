from bs4 import BeautifulSoup
import pandas as pd
from openpyxl import load_workbook
from openpyxl.styles import Border, Side

# HTML file ka naam
html_file = "Oracle eTRM.html"

# HTML file read
with open(html_file, "r") as f:
    soup = BeautifulSoup(f, "html.parser")

# Excel writer
output_file = "output.xlsx"
writer = pd.ExcelWriter(output_file, engine="openpyxl")

# Sare Table: sections dhoondho
for tag in soup.find_all(text=lambda t: "Table:" in t):
    table_name = tag.split("Table:")[-1].strip()

    # "Columns" ke baad wala table lo
    columns_heading = tag.find_next(string=lambda t: "Columns" in t)
    table_tag = columns_heading.find_next("table") if columns_heading else None

    if table_tag:
        try:
            df = pd.read_html(str(table_tag), flavor="lxml")[0]
        except:
            df = pd.read_html(str(table_tag), flavor="html5lib")[0]

        # Naye columns add karo
        df.insert(0, "Sequence No.", range(1, len(df) + 1))
        df.insert(1, "Table Name", table_name)

        # Sheet name max 31 char hota hai
        safe_name = table_name[:31]

        # Excel me likho
        df.to_excel(writer, sheet_name=safe_name, index=False)

# Save file
writer.close()

# Ab borders lagane ke liye open karo
wb = load_workbook(output_file)
thin_border = Border(
    left=Side(style="thin"),
    right=Side(style="thin"),
    top=Side(style="thin"),
    bottom=Side(style="thin")
)

for sheet in wb.sheetnames:
    ws = wb[sheet]
    # Har cell ke around border lagao
    for row in ws.iter_rows():
        for cell in row:
            cell.border = thin_border

# Save final file
wb.save(output_file)

print("âœ… Final Excel ready with borders, sequence no. & table name:", output_file)
