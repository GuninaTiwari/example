import pdfplumber
import re
import openpyxl
from openpyxl.styles import Border, Side

# PDF file ka path
pdf_path = "input.pdf"
output_excel = "output.xlsx"

# Excel workbook create
wb = openpyxl.Workbook()
wb.remove(wb.active)  # default empty sheet remove kar do

# Border style define
thin_border = Border(
    left=Side(style="thin"),
    right=Side(style="thin"),
    top=Side(style="thin"),
    bottom=Side(style="thin")
)

with pdfplumber.open(pdf_path) as pdf:
    for page in pdf.pages:
        text = page.extract_text()
        if not text:
            continue

        # Split line by line
        lines = text.split("\n")

        table_name = None
        capture = False
        current_table = []

        for line in lines:
            # Check for table name
            match = re.match(r"Table\s*:\s*(.+)", line, re.IGNORECASE)
            if match:
                # Agar pehle ka data mila ho to save karo
                if table_name and current_table:
                    # Write to Excel sheet
                    sheet = wb.create_sheet(title=table_name[:31])  # Excel sheet name max 31 char
                    sheet.append(["Seq"] + current_table[0])  # header row with sequence

                    for idx, row in enumerate(current_table[1:], start=1):
                        sheet.append([idx] + row)

                    # Borders lagana
                    for row in sheet.iter_rows():
                        for cell in row:
                            cell.border = thin_border

                # Naya table start
                table_name = match.group(1).strip()
                current_table = []
                capture = False

            # Start capturing when "Columns" appears
            if re.match(r"^\s*Columns\s*$", line, re.IGNORECASE):
                capture = True
                continue

            if capture:
                # stop capturing if another metadata section starts
                if re.match(r"^(Table|Description|Primary key|Foreign key|Indexes|Comments)\s*:", line, re.IGNORECASE):
                    capture = False
                else:
                    # Split row into columns by spaces or tabs
                    row = re.split(r"\s{2,}|\t", line.strip())
                    if row and any(cell.strip() for cell in row):
                        current_table.append(row)

        # Last table save karo (last page ke liye)
        if table_name and current_table:
            sheet = wb.create_sheet(title=table_name[:31])
            sheet.append(["Seq"] + current_table[0])  # header row with sequence

            for idx, row in enumerate(current_table[1:], start=1):
                sheet.append([idx] + row)

            for row in sheet.iter_rows():
                for cell in row:
                    cell.border = thin_border

# Save workbook
wb.save(output_excel)
print(f"âœ… Excel file created: {output_excel}")
